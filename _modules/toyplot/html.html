

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>toyplot.html &mdash; Toyplot 0.1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/toyplot.css" type="text/css" />
  

  
    <link rel="top" title="Toyplot 0.1.0 documentation" href="../../index.html"/>
        <link rel="up" title="toyplot" href="../toyplot.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../index.html" class="fa fa-home"> Toyplot</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../../ethos.html">The Toyplot Ethos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installing Toyplot</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#using-your-os-package-manager">Using Your OS Package Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#using-pip-easy-install">Using Pip / Easy Install</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#from-source">From Source</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">The Toyplot Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial.html#styles">Styles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial.html#plotting">Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial.html#palettes">Palettes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial.html#filled-regions">Filled Regions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial.html#barplots">Barplots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial.html#plots-revisited">Plots Revisited</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial.html#scatterplots">Scatterplots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial.html#markers">Markers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial.html#rendering">Rendering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial.html#axes">Axes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial.html#animation">Animation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../hacking.html">Toyplot for Hackers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../hacking.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hacking.html#code-walkthrough">Code Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hacking.html#running-regression-tests">Running Regression Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hacking.html#modifying-regression-tests">Modifying Regression Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hacking.html#test-coverage">Test Coverage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hacking.html#building-the-documentation">Building the Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">The Toyplot Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../toyplot.html">toyplot module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../toyplot.color.html">toyplot.color module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../toyplot.color.css.html">toyplot.color.css module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../backends.html">Toyplot Backends</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Toyplot</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
          <li><a href="../toyplot.html">toyplot</a> &raquo;</li>
      
    <li>toyplot.html</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <h1>Source code for toyplot.html</h1><div class="highlight"><pre>
<span class="c"># Copyright 2014, Sandia Corporation. Under the terms of Contract</span>
<span class="c"># DE-AC04-94AL85000 with Sandia Corporation, the U.S. Government retains certain</span>
<span class="c"># rights in this software.</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">toyplot.svg</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="kn">as</span> <span class="nn">xml</span>

<div class="viewcode-block" id="render"><a class="viewcode-back" href="../../toyplot.html.html#toyplot.html.render">[docs]</a><span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">fobj</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Render the HTML representation of a canvas.</span>

<span class="sd">  Generates HTML markup with an embedded SVG representation of the canvas, plus</span>
<span class="sd">  JavaScript code for interactivity.  If the canvas contains animation, the</span>
<span class="sd">  markup will include an HTML user interface to control playback.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  canvas : :class:`toyplot.Canvas`</span>
<span class="sd">    The canvas to be rendered.</span>

<span class="sd">  fobj : file-like object or string, optional</span>
<span class="sd">    The file to write.  Use a string filepath to write data directly to disk.</span>
<span class="sd">    If `None` (the default), the HTML tree will be returned to the caller</span>
<span class="sd">    instead.</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  html : xml.etree.ElementTree.Element or `None`</span>
<span class="sd">    HTML representation of `canvas`, as a DOM tree, or `None` if the caller</span>
<span class="sd">    specifies the `fobj` parameter.</span>

<span class="sd">  Notes</span>
<span class="sd">  -----</span>
<span class="sd">  The output HTML embeds an SVG representation of the canvas generated with</span>
<span class="sd">  :func:`toyplot.svg.render`.</span>

<span class="sd">  Note that the output HTML is a fragment wrapped in a &lt;div&gt;, suitable for</span>
<span class="sd">  embedding in a larger document.  It is the caller&#39;s responsibility to</span>
<span class="sd">  supply the &lt;html&gt;, &lt;body&gt; etc. if the result is intended as a standalone</span>
<span class="sd">  HTML document.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">svg</span><span class="p">,</span> <span class="n">svg_animation</span> <span class="o">=</span> <span class="n">toyplot</span><span class="o">.</span><span class="n">svg</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">animation</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

  <span class="n">root</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s">&quot;div&quot;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s">&quot;center&quot;</span><span class="p">,</span> <span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;class&quot;</span><span class="p">:</span><span class="s">&quot;toyplot&quot;</span><span class="p">},</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;t&quot;</span> <span class="o">+</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">)</span>
  <span class="n">root</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">svg</span><span class="p">)</span>

  <span class="n">controls</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s">&quot;div&quot;</span><span class="p">,</span> <span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;class&quot;</span><span class="p">:</span><span class="s">&quot;toyplot-controls&quot;</span><span class="p">})</span>
  <span class="n">mark_popup</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">controls</span><span class="p">,</span> <span class="s">&quot;ul&quot;</span><span class="p">,</span> <span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;class&quot;</span><span class="p">:</span><span class="s">&quot;toyplot-mark-popup&quot;</span><span class="p">},</span> <span class="n">onmouseleave</span><span class="o">=</span><span class="s">&quot;this.style.visibility=&#39;hidden&#39;&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">toyplot</span><span class="o">.</span><span class="n">svg</span><span class="o">.</span><span class="n">_css_style</span><span class="p">({</span>
    <span class="s">&quot;background&quot;</span><span class="p">:</span><span class="s">&quot;rgba(0%,0%,0%,0.75)&quot;</span><span class="p">,</span>
    <span class="s">&quot;border&quot;</span><span class="p">:</span><span class="s">&quot;0&quot;</span><span class="p">,</span>
    <span class="s">&quot;border-radius&quot;</span><span class="p">:</span><span class="s">&quot;6px&quot;</span><span class="p">,</span>
    <span class="s">&quot;color&quot;</span><span class="p">:</span><span class="s">&quot;white&quot;</span><span class="p">,</span>
    <span class="s">&quot;cursor&quot;</span><span class="p">:</span><span class="s">&quot;default&quot;</span><span class="p">,</span>
    <span class="s">&quot;list-style&quot;</span><span class="p">:</span><span class="s">&quot;none&quot;</span><span class="p">,</span>
    <span class="s">&quot;margin&quot;</span><span class="p">:</span><span class="s">&quot;0&quot;</span><span class="p">,</span>
    <span class="s">&quot;padding&quot;</span><span class="p">:</span><span class="s">&quot;5px&quot;</span><span class="p">,</span>
    <span class="s">&quot;position&quot;</span><span class="p">:</span><span class="s">&quot;fixed&quot;</span><span class="p">,</span>
    <span class="s">&quot;visibility&quot;</span><span class="p">:</span><span class="s">&quot;hidden&quot;</span><span class="p">,</span>
    <span class="p">}))</span>
  <span class="n">xml</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">mark_popup</span><span class="p">,</span> <span class="s">&quot;li&quot;</span><span class="p">,</span> <span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;class&quot;</span><span class="p">:</span><span class="s">&quot;toyplot-mark-popup-title&quot;</span><span class="p">},</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;color:lightgray;cursor:default;padding:5px&quot;</span><span class="p">)</span>
  <span class="n">xml</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">mark_popup</span><span class="p">,</span> <span class="s">&quot;li&quot;</span><span class="p">,</span> <span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;class&quot;</span><span class="p">:</span><span class="s">&quot;toyplot-mark-popup-save-csv&quot;</span><span class="p">},</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;border-radius:3px;padding:5px&quot;</span><span class="p">,</span> <span class="n">onmouseover</span><span class="o">=</span><span class="s">&quot;this.style.color=&#39;steelblue&#39;;this.style.background=&#39;white&#39;&quot;</span><span class="p">,</span> <span class="n">onmouseout</span><span class="o">=</span><span class="s">&quot;this.style.color=&#39;white&#39;;this.style.background=&#39;steelblue&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&quot;Save as .csv&quot;</span>

  <span class="k">if</span> <span class="n">svg</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;.//text&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">xml</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">controls</span><span class="p">,</span> <span class="s">&quot;script&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    (function()</span>
<span class="s">    {</span>
<span class="s">      // Workaround for browsers that don&#39;t support alignment-baseline</span>
<span class="s">      if(window.CSS !== undefined &amp;&amp; window.CSS.supports !== undefined)</span>
<span class="s">      {</span>
<span class="s">        if(!window.CSS.supports(&quot;alignment-baseline&quot;, &quot;middle&quot;))</span>
<span class="s">        {</span>
<span class="s">          var re = /\s*alignment-baseline\s*:\s*([^;\s]*)\s*/;</span>
<span class="s">          var text = document.querySelectorAll(&quot;#</span><span class="si">%s</span><span class="s"> text&quot;);</span>
<span class="s">          for(var i = 0; i != text.length; ++i)</span>
<span class="s">          {</span>
<span class="s">            var match = re.exec(text[i].attributes.style.value);</span>
<span class="s">            if(match)</span>
<span class="s">            {</span>
<span class="s">              if(match[1] == &quot;middle&quot;)</span>
<span class="s">              {</span>
<span class="s">                var style = getComputedStyle(text[i]);</span>
<span class="s">                var font_size = style.fontSize.substr(0, style.fontSize.length - 2);</span>
<span class="s">                var dy = text[i].dy.baseVal.length ? text[i].dy.baseVal[0].value : 0;</span>
<span class="s">                dy += 0.4 * font_size;</span>
<span class="s">                text[i].setAttribute(&quot;dy&quot;, dy);</span>
<span class="s">              }</span>
<span class="s">            }</span>
<span class="s">          }</span>
<span class="s">        }</span>
<span class="s">        if(!window.CSS.supports(&quot;baseline-shift&quot;, &quot;0&quot;))</span>
<span class="s">        {</span>
<span class="s">          var re = /\s*baseline-shift\s*:\s*([^;\s]*)\s*/;</span>
<span class="s">          var text = document.querySelectorAll(&quot;#</span><span class="si">%s</span><span class="s"> text&quot;);</span>
<span class="s">          for(var i = 0; i != text.length; ++i)</span>
<span class="s">          {</span>
<span class="s">            var match = re.exec(text[i].attributes.style.value);</span>
<span class="s">            if(match)</span>
<span class="s">            {</span>
<span class="s">              var style = getComputedStyle(text[i]);</span>
<span class="s">              var font_size = style.fontSize.substr(0, style.fontSize.length - 2);</span>
<span class="s">              var percent = 0.01 * match[1].substr(0, match[1].length-1);</span>
<span class="s">              var dy = text[i].dy.baseVal.length ? text[i].dy.baseVal[0].value : 0;</span>
<span class="s">              dy -= percent * font_size</span>
<span class="s">              text[i].setAttribute(&quot;dy&quot;, dy);</span>
<span class="s">            }</span>
<span class="s">          }</span>
<span class="s">        }</span>
<span class="s">      }</span>
<span class="s">    })();</span>
<span class="s">    &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">),</span> <span class="n">root</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">))</span>

  <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">svg</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="s">&quot;toyplot:data-table&quot;</span><span class="p">)):</span>
    <span class="n">xml</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">controls</span><span class="p">,</span> <span class="s">&quot;script&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    // Allow users to extract embedded raw data</span>
<span class="s">    (function()</span>
<span class="s">    {</span>
<span class="s">      var root_id=&quot;</span><span class="si">%s</span><span class="s">&quot;;</span>

<span class="s">      function save_csv(dataset)</span>
<span class="s">      {</span>
<span class="s">        uri = &quot;data:text/csv;charset=utf-8,&quot;;</span>
<span class="s">        data = JSON.parse(dataset.textContent);</span>
<span class="s">        uri += data.names.join(&quot;,&quot;) + &quot;</span><span class="se">\\</span><span class="s">n&quot;;</span>
<span class="s">        for(var i = 0; i != data.data[0].length; ++i)</span>
<span class="s">        {</span>
<span class="s">          for(var j = 0; j != data.data.length; ++j)</span>
<span class="s">          {</span>
<span class="s">            if(j)</span>
<span class="s">              uri += &quot;,&quot;;</span>
<span class="s">            uri += data.data[j][i];</span>
<span class="s">          }</span>
<span class="s">          uri += &quot;</span><span class="se">\\</span><span class="s">n&quot;;</span>
<span class="s">        }</span>

<span class="s">        uri = encodeURI(uri);</span>
<span class="s">        window.open(uri);</span>
<span class="s">      }</span>

<span class="s">      function open_popup(dataset)</span>
<span class="s">      {</span>
<span class="s">        return function(e)</span>
<span class="s">        {</span>
<span class="s">          var popup = document.querySelector(&quot;#&quot; + root_id + &quot; .toyplot-mark-popup&quot;);</span>
<span class="s">          popup.querySelector(&quot;.toyplot-mark-popup-title&quot;).innerHTML = dataset.getAttribute(&quot;title&quot;);</span>
<span class="s">          popup.querySelector(&quot;.toyplot-mark-popup-save-csv&quot;).onclick = function() { popup.style.visibility = &quot;hidden&quot;; save_csv(dataset); }</span>
<span class="s">          popup.style.left = (e.clientX - 50) + &quot;px&quot;;</span>
<span class="s">          popup.style.top = (e.clientY - 20) + &quot;px&quot;;</span>
<span class="s">          popup.style.visibility = &quot;visible&quot;;</span>
<span class="s">          e.stopPropagation();</span>
<span class="s">          e.preventDefault();</span>
<span class="s">        }</span>

<span class="s">      }</span>

<span class="s">      var datasets = document.querySelectorAll(&quot;#&quot; + root_id + &quot; toyplot</span><span class="se">\\\\</span><span class="s">:data-table&quot;);</span>
<span class="s">      for(var i = 0; i != datasets.length; ++i)</span>
<span class="s">      {</span>
<span class="s">        var dataset = datasets[i];</span>
<span class="s">        var mark = dataset.parentElement;</span>
<span class="s">        mark.oncontextmenu = open_popup(dataset);</span>
<span class="s">      }</span>
<span class="s">    })();</span>
<span class="s">    &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">),)</span>

  <span class="k">if</span> <span class="n">svg</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;.//*[@class=&#39;toyplot-coordinates&#39;]&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">xml</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">controls</span><span class="p">,</span> <span class="s">&quot;script&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    (function()</span>
<span class="s">    {</span>
<span class="s">      var root_id=</span><span class="si">%s</span><span class="s">;</span>

<span class="s">      function sign(x)</span>
<span class="s">      {</span>
<span class="s">        if(x &lt; 0)</span>
<span class="s">          return -1;</span>
<span class="s">        if(x &gt; 0)</span>
<span class="s">          return 1;</span>
<span class="s">        return 0;</span>
<span class="s">      }</span>

<span class="s">      function log_n(x, base)</span>
<span class="s">      {</span>
<span class="s">        return Math.log(x) / Math.log(base);</span>
<span class="s">      }</span>

<span class="s">      function mix(a, b, amount)</span>
<span class="s">      {</span>
<span class="s">        return ((1.0 - amount) * a) + (amount * b);</span>
<span class="s">      }</span>

<span class="s">      // Compute mouse coordinates relative to a DOM object, with thanks to d3js.org, where this code originated.</span>
<span class="s">      function d3_mousePoint(container, e)</span>
<span class="s">      {</span>
<span class="s">        if (e.changedTouches) e = e.changedTouches[0];</span>
<span class="s">        var svg = container.ownerSVGElement || container;</span>
<span class="s">        if (svg.createSVGPoint) {</span>
<span class="s">          var point = svg.createSVGPoint();</span>
<span class="s">          point.x = e.clientX, point.y = e.clientY;</span>
<span class="s">          point = point.matrixTransform(container.getScreenCTM().inverse());</span>
<span class="s">          return [point.x, point.y];</span>
<span class="s">        }</span>
<span class="s">        var rect = container.getBoundingClientRect();</span>
<span class="s">        return [e.clientX - rect.left - container.clientLeft, e.clientY - rect.top - container.clientTop];</span>
<span class="s">      };</span>

<span class="s">      function display_coordinates(e)</span>
<span class="s">      {</span>
<span class="s">        var x = null;</span>
<span class="s">        var y = null;</span>

<span class="s">        var axes = e.currentTarget.parentElement;</span>
<span class="s">        var data = JSON.parse(axes.querySelector(&quot;toyplot</span><span class="se">\\\\</span><span class="s">:axes&quot;).textContent);</span>

<span class="s">        point = d3_mousePoint(e.target, e);</span>

<span class="s">        for(var i = 0; i != data[&quot;x&quot;].length; ++i)</span>
<span class="s">        {</span>
<span class="s">          var segment = data[&quot;x&quot;][i];</span>
<span class="s">          if(segment.range.min &lt;= point[0] &amp;&amp; point[0] &lt; segment.range.max)</span>
<span class="s">          {</span>
<span class="s">            var normalized = (point[0] - segment.range.min) / (segment.range.max - segment.range.min);</span>
<span class="s">            if(segment.scale == &quot;linear&quot;)</span>
<span class="s">            {</span>
<span class="s">              x = Number(mix(segment.domain.min, segment.domain.max, normalized)).toFixed(2);</span>
<span class="s">            }</span>
<span class="s">            else if(segment.scale == &quot;log&quot;)</span>
<span class="s">            {</span>
<span class="s">              x = Number(sign(segment.domain.min) * Math.pow(segment.base, mix(log_n(Math.abs(segment.domain.min), segment.base), log_n(Math.abs(segment.domain.max), segment.base), normalized))).toFixed(2);</span>
<span class="s">            }</span>
<span class="s">          }</span>
<span class="s">        }</span>

<span class="s">        for(var i = 0; i != data[&quot;y&quot;].length; ++i)</span>
<span class="s">        {</span>
<span class="s">          var segment = data[&quot;y&quot;][i];</span>
<span class="s">          if(segment.range.min &lt;= point[1] &amp;&amp; point[1] &lt; segment.range.max)</span>
<span class="s">          {</span>
<span class="s">            var normalized = (segment.range.max - point[1]) / (segment.range.max - segment.range.min);</span>
<span class="s">            if(segment.scale == &quot;linear&quot;)</span>
<span class="s">            {</span>
<span class="s">              y = Number(mix(segment.domain.min, segment.domain.max, normalized)).toFixed(2);</span>
<span class="s">            }</span>
<span class="s">            else if(segment.scale == &quot;log&quot;)</span>
<span class="s">            {</span>
<span class="s">              y = Number(sign(segment.domain.min) * Math.pow(segment.base, mix(log_n(Math.abs(segment.domain.min), segment.base), log_n(Math.abs(segment.domain.max), segment.base), normalized))).toFixed(2);</span>
<span class="s">            }</span>
<span class="s">          }</span>
<span class="s">        }</span>

<span class="s">        if(x !== null &amp;&amp; y !== null)</span>
<span class="s">          text = &quot;x=&quot; + x + &quot; y=&quot; + y;</span>
<span class="s">        else if(x !== null)</span>
<span class="s">          text = &quot;x=&quot; + x;</span>
<span class="s">        else if(y !== null)</span>
<span class="s">          text = &quot;y=&quot; + y;</span>
<span class="s">        else</span>
<span class="s">          text = null;</span>

<span class="s">        if(text !== null)</span>
<span class="s">        {</span>
<span class="s">          var coordinates = axes.querySelectorAll(&quot;.toyplot-coordinates&quot;);</span>
<span class="s">          for(var i = 0; i != coordinates.length; ++i)</span>
<span class="s">          {</span>
<span class="s">            coordinates[i].style.visibility = &quot;visible&quot;;</span>
<span class="s">            coordinates[i].querySelector(&quot;text&quot;).textContent = text;</span>
<span class="s">          }</span>
<span class="s">        }</span>
<span class="s">      }</span>

<span class="s">      function clear_coordinates(e)</span>
<span class="s">      {</span>
<span class="s">        var axes = e.currentTarget.parentElement;</span>
<span class="s">        var coordinates = axes.querySelectorAll(&quot;.toyplot-coordinates&quot;);</span>
<span class="s">        for(var i = 0; i != coordinates.length; ++i)</span>
<span class="s">          coordinates[i].style.visibility = &quot;hidden&quot;;</span>
<span class="s">      }</span>

<span class="s">      var axes = document.querySelectorAll(&quot;#&quot; + root_id + &quot; .toyplot-Axes2D .toyplot-coordinate-events&quot;);</span>
<span class="s">      for(var i = 0; i != axes.length; ++i)</span>
<span class="s">      {</span>
<span class="s">        axes[i].onmousemove = display_coordinates;</span>
<span class="s">        axes[i].onmouseout = clear_coordinates;</span>
<span class="s">      }</span>
<span class="s">    })();</span>
<span class="s">    &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)),)</span>

  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">svg_animation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">times</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">svg_animation</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">durations</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">times</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">changes</span> <span class="o">=</span> <span class="p">[</span><span class="n">change</span> <span class="k">for</span> <span class="n">time</span><span class="p">,</span> <span class="n">change</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">svg_animation</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())]</span>

    <span class="n">vcr_controls</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">controls</span><span class="p">,</span> <span class="s">&quot;div&quot;</span><span class="p">,</span> <span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;class&quot;</span><span class="p">:</span><span class="s">&quot;toyplot-vcr-controls&quot;</span><span class="p">})</span>
    <span class="n">xml</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">vcr_controls</span><span class="p">,</span> <span class="s">&quot;input&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;Frame&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;range&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="s">&quot;0&quot;</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;0&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">-current-frame&quot;</span> <span class="o">%</span> <span class="n">root</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">))</span>
    <span class="n">xml</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">vcr_controls</span><span class="p">,</span> <span class="s">&quot;button&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;Rewind&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;width:40px;height:24px&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">-rewind&quot;</span> <span class="o">%</span> <span class="n">root</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xml</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="s">&quot;&quot;&quot;&lt;svg width=&quot;20&quot; height=&quot;20&quot;&gt;&lt;polygon points=&quot;10,5 0,10 10,15&quot; stroke=&quot;none&quot; fill=&quot;black&quot;/&gt;&lt;polygon points=&quot;20,5 10,10 20,15&quot; stroke=&quot;none&quot; fill=&quot;black&quot;/&gt;&lt;/svg&gt;&quot;&quot;&quot;</span><span class="p">))</span>
    <span class="n">xml</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">vcr_controls</span><span class="p">,</span> <span class="s">&quot;button&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;Reverse Play&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;width:40px;height:24px&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">-reverse-play&quot;</span> <span class="o">%</span> <span class="n">root</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xml</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="s">&quot;&quot;&quot;&lt;svg width=&quot;20&quot; height=&quot;20&quot;&gt;&lt;polygon points=&quot;15,5 5,10 15,15&quot; stroke=&quot;none&quot; fill=&quot;black&quot;/&gt;&lt;/svg&gt;&quot;&quot;&quot;</span><span class="p">))</span>
    <span class="n">xml</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">vcr_controls</span><span class="p">,</span> <span class="s">&quot;button&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;Frame Rewind&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;width:40px;height:24px&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">-frame-rewind&quot;</span> <span class="o">%</span> <span class="n">root</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xml</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="s">&quot;&quot;&quot;&lt;svg width=&quot;20&quot; height=&quot;20&quot;&gt;&lt;polygon points=&quot;15,5 5,10 15,15&quot; stroke=&quot;none&quot; fill=&quot;black&quot;/&gt;&lt;rect x=&quot;17&quot; y=&quot;5&quot; width=&quot;2&quot; height=&quot;10&quot; stroke=&quot;none&quot; fill=&quot;black&quot;/&gt;&lt;/svg&gt;&quot;&quot;&quot;</span><span class="p">))</span>
    <span class="n">xml</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">vcr_controls</span><span class="p">,</span> <span class="s">&quot;button&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;Stop&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;width:40px;height:24px&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">-stop&quot;</span> <span class="o">%</span> <span class="n">root</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xml</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="s">&quot;&quot;&quot;&lt;svg width=&quot;20&quot; height=&quot;20&quot;&gt;&lt;rect x=&quot;5&quot; y=&quot;5&quot; width=&quot;10&quot; height=&quot;10&quot; stroke=&quot;none&quot; fill=&quot;black&quot;/&gt;&lt;/svg&gt;&quot;&quot;&quot;</span><span class="p">))</span>
    <span class="n">xml</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">vcr_controls</span><span class="p">,</span> <span class="s">&quot;button&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;Frame Advance&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;width:40px;height:24px&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">-frame-advance&quot;</span> <span class="o">%</span> <span class="n">root</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xml</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="s">&quot;&quot;&quot;&lt;svg width=&quot;20&quot; height=&quot;20&quot;&gt;&lt;polygon points=&quot;5,5 15,10 5,15&quot; stroke=&quot;none&quot; fill=&quot;black&quot;/&gt;&lt;rect x=&quot;1&quot; y=&quot;5&quot; width=&quot;2&quot; height=&quot;10&quot; stroke=&quot;none&quot; fill=&quot;black&quot;/&gt;&lt;/svg&gt;&quot;&quot;&quot;</span><span class="p">))</span>
    <span class="n">xml</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">vcr_controls</span><span class="p">,</span> <span class="s">&quot;button&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;Play&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;width:40px;height:24px&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">-forward-play&quot;</span> <span class="o">%</span> <span class="n">root</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xml</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="s">&quot;&quot;&quot;&lt;svg width=&quot;20&quot; height=&quot;20&quot;&gt;&lt;polygon points=&quot;5,5 15,10 5,15&quot; stroke=&quot;none&quot; fill=&quot;black&quot;/&gt;&lt;/svg&gt;&quot;&quot;&quot;</span><span class="p">))</span>
    <span class="n">xml</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">vcr_controls</span><span class="p">,</span> <span class="s">&quot;button&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;Fast Forward&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;width:40px;height:24px&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">-fast-forward&quot;</span> <span class="o">%</span> <span class="n">root</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xml</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="s">&quot;&quot;&quot;&lt;svg width=&quot;20&quot; height=&quot;20&quot;&gt;&lt;polygon points=&quot;0,5 10,10 0,15&quot; stroke=&quot;none&quot; fill=&quot;black&quot;/&gt;&lt;polygon points=&quot;10,5 20,10 10,15&quot; stroke=&quot;none&quot; fill=&quot;black&quot;/&gt;&lt;/svg&gt;&quot;&quot;&quot;</span><span class="p">))</span>

    <span class="n">xml</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">controls</span><span class="p">,</span> <span class="s">&quot;script&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    (function()</span>
<span class="s">    {</span>
<span class="s">      var root_id = </span><span class="si">%s</span><span class="s">;</span>
<span class="s">      var frame_durations = </span><span class="si">%s</span><span class="s">;</span>
<span class="s">      var state_changes = </span><span class="si">%s</span><span class="s">;</span>

<span class="s">      var current_frame = null;</span>
<span class="s">      var timeout = null;</span>

<span class="s">      function on_set_frame()</span>
<span class="s">      {</span>
<span class="s">        if(timeout !== null)</span>
<span class="s">          window.clearTimeout(timeout);</span>
<span class="s">        timeout = null;</span>
<span class="s">        set_current_frame(document.getElementById(root_id + &quot;-current-frame&quot;).valueAsNumber);</span>
<span class="s">        for(var frame = 0; frame &lt;= current_frame; ++frame)</span>
<span class="s">          render_changes(frame);</span>
<span class="s">      }</span>

<span class="s">      function on_frame_rewind()</span>
<span class="s">      {</span>
<span class="s">        if(timeout !== null)</span>
<span class="s">          window.clearTimeout(timeout);</span>
<span class="s">        set_current_frame((current_frame - 1 + frame_durations.length) </span><span class="si">%%</span><span class="s"> frame_durations.length);</span>
<span class="s">        for(var frame = 0; frame &lt;= current_frame; ++frame)</span>
<span class="s">          render_changes(frame);</span>
<span class="s">      }</span>

<span class="s">      function on_rewind()</span>
<span class="s">      {</span>
<span class="s">        render_changes(0);</span>
<span class="s">        set_current_frame(0);</span>
<span class="s">      }</span>

<span class="s">      function on_play_reverse()</span>
<span class="s">      {</span>
<span class="s">        if(timeout !== null)</span>
<span class="s">          window.clearTimeout(timeout);</span>
<span class="s">        timeout = window.setTimeout(play_reverse, frame_durations[(current_frame - 1 + frame_durations.length) </span><span class="si">%%</span><span class="s"> frame_durations.length] * 1000);</span>
<span class="s">      }</span>

<span class="s">      function on_stop()</span>
<span class="s">      {</span>
<span class="s">        if(timeout !== null)</span>
<span class="s">          window.clearTimeout(timeout);</span>
<span class="s">        timeout = null;</span>
<span class="s">      }</span>

<span class="s">      function on_play_forward()</span>
<span class="s">      {</span>
<span class="s">        if(timeout !== null)</span>
<span class="s">          window.clearTimeout(timeout);</span>
<span class="s">        timeout = window.setTimeout(play_forward, frame_durations[current_frame] * 1000);</span>
<span class="s">      }</span>

<span class="s">      function on_fast_forward()</span>
<span class="s">      {</span>
<span class="s">        for(var frame = 0; frame != frame_durations.length; ++frame)</span>
<span class="s">          render_changes(frame);</span>
<span class="s">        set_current_frame(frame_durations.length - 1);</span>
<span class="s">      }</span>

<span class="s">      function on_frame_advance()</span>
<span class="s">      {</span>
<span class="s">        if(timeout !== null)</span>
<span class="s">          window.clearTimeout(timeout);</span>
<span class="s">        set_current_frame((current_frame + 1) </span><span class="si">%%</span><span class="s"> frame_durations.length);</span>
<span class="s">        render_changes(current_frame);</span>
<span class="s">      }</span>

<span class="s">      function set_current_frame(frame)</span>
<span class="s">      {</span>
<span class="s">        current_frame = frame;</span>
<span class="s">        document.getElementById(root_id + &quot;-current-frame&quot;).value = frame;</span>
<span class="s">      }</span>

<span class="s">      function play_reverse()</span>
<span class="s">      {</span>
<span class="s">        set_current_frame((current_frame - 1 + frame_durations.length) </span><span class="si">%%</span><span class="s"> frame_durations.length);</span>
<span class="s">        for(var frame = 0; frame &lt;= current_frame; ++frame)</span>
<span class="s">          render_changes(frame);</span>
<span class="s">        timeout = window.setTimeout(play_reverse, frame_durations[(current_frame - 1 + frame_durations.length) </span><span class="si">%%</span><span class="s"> frame_durations.length] * 1000);</span>
<span class="s">      }</span>

<span class="s">      function play_forward()</span>
<span class="s">      {</span>
<span class="s">        set_current_frame((current_frame + 1) </span><span class="si">%%</span><span class="s"> frame_durations.length);</span>
<span class="s">        render_changes(current_frame);</span>
<span class="s">        timeout = window.setTimeout(play_forward, frame_durations[current_frame] * 1000);</span>
<span class="s">      }</span>

<span class="s">      var item_cache = {};</span>
<span class="s">      function get_item(id)</span>
<span class="s">      {</span>
<span class="s">        if(!(id in item_cache))</span>
<span class="s">          item_cache[id] = document.getElementById(id);</span>
<span class="s">        return item_cache[id];</span>
<span class="s">      }</span>

<span class="s">      function render_changes(frame)</span>
<span class="s">      {</span>
<span class="s">        var changes = state_changes[frame];</span>
<span class="s">        for(var type in changes)</span>
<span class="s">        {</span>
<span class="s">          var type_changes = changes[type]</span>
<span class="s">          if(type == &quot;set-mark-style&quot;)</span>
<span class="s">          {</span>
<span class="s">            for(var i = 0; i != type_changes.length; ++i)</span>
<span class="s">            {</span>
<span class="s">              var mark_style = type_changes[i];</span>
<span class="s">              var mark = get_item(mark_style[0]);</span>
<span class="s">              for(var key in mark_style[1])</span>
<span class="s">                mark.style.setProperty(key, mark_style[1][key]);</span>
<span class="s">            }</span>
<span class="s">          }</span>
<span class="s">          else if(type == &quot;set-datum-style&quot;)</span>
<span class="s">          {</span>
<span class="s">            for(var i = 0; i != type_changes.length; ++i)</span>
<span class="s">            {</span>
<span class="s">              var datum_style = type_changes[i];</span>
<span class="s">              var datum = get_item(datum_style[0]).querySelectorAll(&quot;.toyplot-Series&quot;)[datum_style[1]].querySelectorAll(&quot;.toyplot-Datum&quot;)[datum_style[2]];</span>
<span class="s">              for(var key in datum_style[3])</span>
<span class="s">                datum.style.setProperty(key, datum_style[3][key]);</span>
<span class="s">            }</span>
<span class="s">          }</span>
<span class="s">          else if(type == &quot;set-mark-text&quot;)</span>
<span class="s">          {</span>
<span class="s">            for(var i = 0; i != type_changes.length; ++i)</span>
<span class="s">            {</span>
<span class="s">              var mark_text = type_changes[i];</span>
<span class="s">              get_item(mark_text[0]).textContent = mark_text[1];</span>
<span class="s">            }</span>
<span class="s">          }</span>
<span class="s">        }</span>
<span class="s">      }</span>

<span class="s">      set_current_frame(0);</span>
<span class="s">      render_changes(current_frame);</span>

<span class="s">      document.getElementById(root_id + &quot;-current-frame&quot;).oninput = on_set_frame;</span>
<span class="s">      document.getElementById(root_id + &quot;-rewind&quot;).onclick = on_rewind;</span>
<span class="s">      document.getElementById(root_id + &quot;-reverse-play&quot;).onclick = on_play_reverse;</span>
<span class="s">      document.getElementById(root_id + &quot;-frame-rewind&quot;).onclick = on_frame_rewind;</span>
<span class="s">      document.getElementById(root_id + &quot;-stop&quot;).onclick = on_stop;</span>
<span class="s">      document.getElementById(root_id + &quot;-frame-advance&quot;).onclick = on_frame_advance;</span>
<span class="s">      document.getElementById(root_id + &quot;-forward-play&quot;).onclick = on_play_forward;</span>
<span class="s">      document.getElementById(root_id + &quot;-fast-forward&quot;).onclick = on_fast_forward;</span>

<span class="s">    })();</span>
<span class="s">    &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span>
      <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)),</span>
      <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">durations</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span>
      <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">changes</span><span class="p">),</span>
      <span class="p">)</span>

  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fobj</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fobj</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
      <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">xml</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&quot;html&quot;</span><span class="p">))</span>
  <span class="k">elif</span> <span class="n">fobj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">xml</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&quot;html&quot;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">root</span>
</pre></div></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Sandia Corporation. Under the terms of Contract
DE-AC04-94AL85000 with Sandia Corporation, the U.S. Government retains certain
rights in this software.  SAND2014-15494W.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>